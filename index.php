<?php

//$name[] = 'String';
//$name[] = 'new value'; // fatal error


//print_r($name);


//echo rand(pow(10, 15-1), pow(10, 15)-1);


//$url = 'connect.azyandelivery.com/webhook_delivery_status.php';
//$data = array("first_name" => "First name","last_name" => "last name","email"=>"email@gmail.com","addresses" => array ("address1" => "some address" ,"city" => "city","country" => "CA", "first_name" =>  "Mother","last_name" =>  "Lastnameson","phone" => "555-1212", "province" => "ON", "zip" => "123 ABC" ) );

//$postdata = json_encode($data);

/*$postdata = '{"job_id":169158650,"created_by":7,"order_id":"YR-3621736,0","recurring_id":"0","recurring_count":0,"partner_order_id":null,"team_id":569346,"vertical":0,"merchant_id":0,"geofence":0,"tags":"","auto_assignment":2,"dispatcher_id":null,"job_hash":"5858f8eefe3e4a7c66c45aec1fdbbbc0","has_pickup":1,"has_delivery":1,"is_routed":0,"pickup_delivery_relationship":"16915864916069097084308825","job_description":"","job_pickup_datetime":"12/02/2020 01:48 pm","job_pickup_name":"Mcdonald`s","job_pickup_phone":"+962 6 582 0000","job_delivery_datetime":"12/02/2020 02:08 pm","job_pickup_latitude":"31.98471944543236","job_pickup_longitude":"35.86592993912808","job_pickup_address":"Al-Madina Al-Munawwara Street, التلاع الشمالي, منطقة تلاع العلي, Amman, 23324, Jordan","job_pickup_email":"majeedko@hotmail.com","job_latitude":"32.028002862593326","job_longitude":"35.964200626568044","customer_username":"Malek","customer_email":"majeed.malki@gmail.com","customer_phone":"+962 7 9994 1115","job_address":"32, الكوم الشرقي, منطقة طارق, Amman, Jordan, 125, 111","creation_datetime":"2020-12-02T11:48:28.000Z","fleet_id":727607,"user_id":563138,"fleet_rating":5,"customer_comment":null,"is_customer_rated":0,"customer_id":28365184,"arrived_datetime":"2020-12-02 13:50:6","started_datetime":"2020-12-02 13:50:4","completed_datetime":"2020-12-02 13:50:10","acknowledged_datetime":"2020-12-02 13:48:49","job_status":2,"is_active":1,"job_type":1,"completed_by_admin":0,"open_tracking_link":0,"timezone":"-120","job_time":"2020-12-02 02:08:0","job_date":"2020-12-02T00:00:00.000Z","job_time_utc":"2020-12-02T12:08:00.000Z","job_date_utc":"2020-12-02T00:00:00.000Z","total_distance_travelled":0,"form_id":null,"customer_rating":5,"driver_comment":null,"remarks":null,"barcode":null,"ride_type":0,"matched_pickup_delivery_relationship":null,"job_vertical":0,"days_started":"0","tookan_shared_secret":"XXOUL3nXwh3WMdXV","distance_in":"KM","access_token":"04656ab076e9ffaf1d1092c00cf430b3b943a9b2520b1cfea6d6e824ba6a7973d52eec7c79a736f8af91ff788ae28eeb33561b1341986d137d83823d810db51fb0d2149b4cd024d02a6028fe0eff8eba70e0fe320c042911e10849677500ac790e6ed60cfb858a6e846461b8836dc8b1169ee05e12cb419d2661ded4b88405bd","domain":"https://agent.azyan.co","agent_workflow":0,"fleet_name":"Majeed","fleet_email":"majeed.malki@azyan.co","fleet_phone":"+962799941115","fleet_latitude":"31.9752753","fleet_longitude":"35.8605108","transport_type":1,"license":"","transport_desc":"","fleet_image":"https://tookan.s3.amazonaws.com/fleet_profile/user.png","job_details_by_fleet":727607,"external_fleet_id":"","fleet_vehicle_type":1,"fleet_vehicle_color":"","fleet_vehicle_description":"","task_status":2,"promo_used":"","custom_fields":[{"data":{"body":[[{"arth":" ","head":"ITEMS","id":0,"val":"The Mushroom Sandwich"},{"arth":" ","head":"QTY","id":1,"val":1},{"arth":" ","head":"AMOUNT","id":2,"val":"JOD 3.40"}],[{"arth":" ","head":"ITEMS","id":0,"val":"Overall Taxes"},{"arth":" ","head":"QTY","id":1,"val":""},{"arth":" ","head":"AMOUNT","id":2,"val":"JOD 0.54"}]],"head":[{"id":0,"arth":" ","show":1,"type":"text","label":"ITEMS","app_side":0,"required":0,"display_name":"ITEMS"},{"id":1,"arth":" ","show":1,"type":"number","label":"QTY","app_side":0,"required":0,"display_name":"QTY"},{"id":2,"arth":" ","show":1,"type":"text","label":"AMOUNT","app_side":0,"required":0,"display_name":"AMOUNT"}],"other":[]},"input":{"body":[[{"arth":" ","head":"ITEMS","id":0,"val":"Majeedko Burger Meal "},{"arth":" ","head":"QTY","id":1,"val":1},{"arth":" ","head":"AMOUNT","id":2,"val":"JOD 8.00"}],[{"arth":" ","head":"ITEMS","id":0,"val":"Pepsi"},{"arth":" ","head":"QTY","id":1,"val":""},{"arth":" ","head":"AMOUNT","id":2,"val":"JOD 0.00"}],[{"arth":" ","head":"ITEMS","id":0,"val":"Chili Sauce"},{"arth":" ","head":"QTY","id":1,"val":""},{"arth":" ","head":"AMOUNT","id":2,"val":"JOD 1.50"}],[{"arth":" ","head":"ITEMS","id":0,"val":"Overall Taxes"},{"arth":" ","head":"QTY","id":1,"val":""},{"arth":" ","head":"AMOUNT","id":2,"val":"JOD 0.02"}]],"head":[{"id":0,"arth":" ","show":1,"type":"text","label":"ITEMS","app_side":0,"required":0,"display_name":"ITEMS"},{"id":1,"arth":" ","show":1,"type":"number","label":"QTY","app_side":0,"required":0,"display_name":"QTY"},{"id":2,"arth":" ","show":1,"type":"text","label":"AMOUNT","app_side":0,"required":0,"display_name":"AMOUNT"},{"label":"Merchant","display_name":"Merchant","type":"location","arth":" ","id":3,"show":1,"app_side":0,"required":0}],"other":[]},"label":"Task_Details","value":1,"app_side":"0","required":0,"data_type":"Table","template_id":"Order_Details","display_name":"Task Details","before_start":0},{"data":"","input":"","label":"Special_Instructions","value":1,"app_side":"0","required":0,"data_type":"Text","template_id":"Order_Details","display_name":"Special Instructions","before_start":0},{"data":"JOD 0.00","input":"JOD 0.00","label":"Discount","value":1,"app_side":"0","required":0,"data_type":"Text","template_id":"Order_Details","display_name":"Discount","before_start":0},{"data":"8.94","input":"9.52","label":"Subtotal","value":1,"app_side":"0","required":0,"data_type":"Text","template_id":"Order_Details","display_name":"Subtotal","before_start":0},{"label":"Payment_Type","display_name":"Payment Type","data_type":"Text","app_side":"0","required":0,"value":1,"data":"CASH","input":"CASH","template_id":"Order_Details","before_start":0},{"input":"","label":"Task_Category","value":1,"app_side":"0","required":0,"data_type":"Text","template_id":"Order_Details","display_name":"Task Category","data":"","before_start":0}],"ref_images":[],"tracking_link":"https://jngl.ml/aecE1Gfdb","job_additional_info":{"yelo_customer_id":1828805},"job_report":{"formula_fields":{"1":[{"display_name":"Base Fare","key":"base_fare","type":1,"surge":"1.000","multiplying_value":"1.400","expression":"1.400*{{{surge}}}","replaced_exp":"1.400*1.000","sum":1.4},{"display_name":"Duration Fare","key":"duration_charge","type":1,"start_value":"0.00","surge":"1.000","multiplying_value":"0.000","expression":"0.000*{{{surge}}}*({{{total_time_in_seconds}}}/60-0.00)","replaced_exp":"0.000*1.000*(921.79/60-0.00)","sum":0},{"display_name":"Waiting Fare","key":"waiting_charge","type":1,"start_value":"0.00","multiplying_value":"0.00","surge":"1.000","expression":"0.00*{{{surge}}}*({{{waiting_time_in_seconds}}}/60-0.00)","replaced_exp":"0.00*1.000*(4/60-0.00)","sum":0},{"display_name":"Distance Fare","key":"distance_fare","type":1,"start_value":"8.000","surge":"1.000","multiplying_value":"0.200","expression":"0.200*{{{surge}}}*({{{job_distance}}}/1000-8.000)","replaced_exp":"0.200*1.000*(14601.906/1000-8.000)","sum":1.32},{"display_name":"Deduction","key":"commission","type":1,"multiplying_value":"0.000","expression":"0.000/100*(-1)*({{{{distance_fare}}}}+{{{{duration_charge}}}}+{{{{base_fare}}}}+{{{{waiting_charge}}}})","replaced_exp":"0.000/100*(-1)*(1.32+0+1.4+0)","sum":0},{"display_name":"Total Amount","key":"final_calculated_earning","type":1,"sum":2.72}],"2":[{"display_name":"Base Fare","key":"base_fare","type":1,"surge":"1.00","multiplying_value":"2.00","expression":"2.00*1.00","replaced_exp":"2.00","sum":2},{"display_name":"Duration Fare","key":"duration_charge","type":1,"start_value":"0.00","surge":"1.00","multiplying_value":"0.00","expression":"0.00*1.00*({{{total_time_in_seconds}}}/60-0.00)","replaced_exp":"0.00","sum":0},{"display_name":"Waiting Fare","key":"waiting_charge","type":1,"start_value":"0.00","multiplying_value":"0.00","surge":"1.00","expression":"0.00*1.00*({{{waiting_time_in_seconds}}}/60-0.00)","replaced_exp":"0.00","sum":0},{"display_name":"Distance Fare","key":"distance_fare","type":1,"start_value":"8.00","surge":"1.00","multiplying_value":"0.50","expression":"0.50*1.00*({{{job_distance}}}/1000-8.00)","replaced_exp":"3.30","sum":3.3},{"display_name":"Deduction","key":"commission","type":1,"multiplying_value":"0.00","expression":"0.00/100*(-1)*({{{{distance_fare}}}}+{{{{duration_charge}}}}+{{{{base_fare}}}}+{{{{waiting_charge}}}})","replaced_exp":"0.00/100*(-1)*(3.3+0+2+0)","sum":0},{"display_name":"Maximum Allowed Amount","key":"max_pricing_allowed_limit","type":1,"sum":5},{"display_name":"Total Amount","key":"final_calculated_pricing","type":1,"sum":5}],"3":[]},"total_fields":{"1":2.72,"2":5,"3":0}},"task_history":[{"id":1029384326,"job_id":169158650,"fleet_id":null,"fleet_name":null,"latitude":null,"longitude":null,"type":"state_changed","description":"Created By Majeed Al Malki - 563138","extra_fields":null,"creation_datetime":"2020-12-02T11:48:28.000Z","creation_date":"2020-12-02T00:00:00.000Z","label_description":"<span class=created>CREATED</span>By Majeed Al Malki - 563138"},{"id":1029385544,"job_id":169158650,"fleet_id":727607,"fleet_name":"Majeed","latitude":"31.9752753","longitude":"35.8605108","type":"state_changed","description":"Accepted at","extra_fields":null,"creation_datetime":"2020-12-02T11:48:49.000Z","creation_date":"2020-12-02T00:00:00.000Z","label_description":"<span class=accepted>ACCEPTED</span>at"},{"id":1029389600,"job_id":169158650,"fleet_id":727607,"fleet_name":"Majeed","latitude":"31.9752753","longitude":"35.8605108","type":"state_changed","description":"Started at","extra_fields":null,"creation_datetime":"2020-12-02T11:50:04.000Z","creation_date":"2020-12-02T00:00:00.000Z","label_description":"<span class=started>STARTED</span>at"},{"id":1029389716,"job_id":169158650,"fleet_id":727607,"fleet_name":"Majeed","latitude":"31.9752753","longitude":"35.8605108","type":"state_changed","description":"Arrived at","extra_fields":null,"creation_datetime":"2020-12-02T11:50:06.000Z","creation_date":"2020-12-02T00:00:00.000Z","label_description":"<span class=arrived>ARRIVED</span>at"},{"id":1029390096,"job_id":169158650,"fleet_id":727607,"fleet_name":"Majeed","latitude":"31.9752753","longitude":"35.8605108","type":"state_changed","description":"Successful at","extra_fields":null,"creation_datetime":"2020-12-02T11:50:12.000Z","creation_date":"2020-12-02T00:00:00.000Z","label_description":"<span class=successful>SUCCESSFUL</span>at"}],"job_state":"Successful","task_state":"SUCCESSFUL","completed_datetime_formatted":"02 Dec 2020 01:50 pm","started_datetime_formatted":"02 Dec 2020 01:50 pm","arrived_datetime_formatted":"02 Dec 2020 01:50 pm","acknowledged_datetime_formatted":"02 Dec 2020 01:48 pm","job_token":"16915864916069097084308825","job_time_formatted":"02 Dec 2020 02:08 pm","timestamp_diff":6000,"total_time_spent_at_task_till_completion":"6 seconds","job_pickup_datetime_formatted":"02 Dec 2020 01:48 pm","job_delivery_datetime_formatted":"02 Dec 2020 02:08 pm","total_distance":"0.00 Km","webhook_type":0,"format":"application/json","template_key":"SUCCESSFUL","is_internal":0,"full_tracking_link":"https://agent.azyan.co/tracking/index.html?jobID=5858f8eefe3e4a7c66c45aec1fdbbbc0"}';

$ch = curl_init($url);
curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $postdata);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: application/json'));
$result = curl_exec($ch);
curl_close($ch);

print_r ($result);*/

	//$address = 'Noida, Utter Pradesh, India';

    //$mapkey = 'AIzaSyCeaW0k95CE6QY_2vOdNaTS8dBWmTWgot8';

	//$url = "https://maps.googleapis.com/maps/api/geocode/json?key=" . $mapkey . "&address=" . urlencode($address);
	//$res = file_get_contents($url);
	//$decode = json_decode($res, true);

	//echo "<>";
	//print_r($decode);
	
	$wpdb = new stdClass();
	$wpdb->prefix = 'wp';

	$query = "
			SELECT SUM( amount ) AS amount
			FROM `{$wpdb->prefix}_wpam_transactions` t
			LEFT JOIN `{$wpdb->prefix}_posts` p ON t.referenceId = p.ID
			WHERE t.affiliateId = '5'
			AND p.post_type = 'shop_order'
			AND p.post_status = 'completed'
		";

	echo $query;

	//echo date("Y-m-d", strtotime('06/12/2020'));
	